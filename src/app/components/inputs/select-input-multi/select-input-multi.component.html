<div class="select-multi">
  @if (label) {
  <label class="select-multi__label">{{ label }}</label>
  }

  <div
    class="select-multi__control"
    [class.select-multi__control--error]="error"
    (click)="toggleDropdown()"
  >
    <div class="select-multi__control__tags">
      @for (label of selectedLabels; track label) {
        <app-tag
          [label]="label"
          size="medium"
          color="default"
          (remove)="removeTagByLabel(label)"
        ></app-tag>
      } @if (selectedLabels.length === 0) {
      <span class="select-multi__control__placeholder">{{ placeholder }}</span>
      }
    </div>

    <div class="select-multi__control__buttons">
      @if (model.length > 0) {
      <app-button
        variant="ghost"
        size="none"
        iconSize="16"
        icon="x"
        (clicked)="clearAll(); $event.stopPropagation()"
        class="select-multi__buttons__clear"
      />
      }
      <app-lucide-icon
        [icon]="'chevron-down'"
        class="select-multi__control__buttons__icon"
        [class]="isOpen ? 'select-multi__control__buttons__icon--open' : ''"
      ></app-lucide-icon>
    </div>
  </div>

  @if (isOpen) {
  <div class="select-multi__dropdown" #dropdownRoot>
    <div class="select-multi__dropdown__search" (click)="$event.stopPropagation()">
      <app-search-filter
        variant="compact"
        [showSubmitButton]="false"
        placeholderText="Buscar..."
        (searchTextChange)="handleSearch($event)"
      />
    </div>

    <div class="select-multi__dropdown__options">
      @for (option of filteredOptions; track option.value) {
      <div
        class="select-multi__dropdown__options__option"
        [class.select-multi__dropdown__options__option--selected]="isSelected(option.value)"
        (click)="toggleSelection(option)"
      >
        {{ option.label }}
      </div>
      } @if (filteredOptions.length === 0) {
      <p class="select-multi__dropdown__options__no-results">Nenhum resultado encontrado</p>
      }
    </div>
  </div>
  } @if (error) {
  <p class="select-multi__error">{{ error }}</p>
  } @else if (description) {
  <p class="select-multi__description">{{ description }}</p>
  }
</div>
